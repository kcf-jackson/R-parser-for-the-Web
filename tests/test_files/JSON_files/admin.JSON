[[],["<-",".install_package_description",["function",[{"dir":"","outDir":"","builtStamp":["character",{}]}],["{",["<-","ok",[".check_package_description",["file.path","dir","\"DESCRIPTION\""]]],["if",["any",[">",["as.integer",["lengths","ok"]],"0L"]],["{",["stop",["paste",["gettext","\"Invalid DESCRIPTION file\""],["paste",["$",[".eval_with_capture",["print","ok"]],"output"],{"collapse":"\"\\n\""}],{"sep":"\"\\n\\n\""}],{"domain":"NA"},{"call.":"FALSE"}]]],["<-","db",[".read_description",["file.path","dir","\"DESCRIPTION\""]]],["<-","nm",["names","db"]],["if",["%in%","\"Built\"","nm"],["{",["<-","db",["[","db",["-",["match","\"Built\"","nm"]]]],["warning",["gettextf","\"*** someone has corrupted the Built field in package '%s' ***\"",["[","db","\"Package\""]],{"domain":"NA"},{"call.":"FALSE"}]]],["<-","OStype",["$","R.version","platform"]],["if",["&&",["grepl","\"-apple-darwin\"","OStype"],["nzchar",["Sys.getenv","\"R_ARCH\""]]],["<-","OStype",["sub","\".*-apple-darwin\"","\"universal-apple-darwin\"","OStype"]]],["<-","Built",["paste0","\"R \"",["paste",["[","R.version",["c","\"major\"","\"minor\""]],{"collapse":"\".\""}],"\"; \"",["if",["dir.exists",["file.path","dir","\"src\""]],"OStype","\"\""],"\"; \"",["if",["==",["length","builtStamp"],"0"],["format",["Sys.time",{}],{"tz":"\"UTC\""},{"usetz":"TRUE"}],"builtStamp"],"\"; \"",[".OStype",{}]]],["<-","db",["c","db",[".expand_package_description_db_R_fields","db"],{"Built":"Built"}]],["<-","ctype",["Sys.getlocale","\"LC_CTYPE\""]],["Sys.setlocale","\"LC_CTYPE\"","\"C\""],["on.exit",["Sys.setlocale","\"LC_CTYPE\"","ctype"]],[".write_description","db",["file.path","outDir","\"DESCRIPTION\""]],["<-","outMetaDir",["file.path","outDir","\"Meta\""]],["if",["&&",["!",["dir.exists","outMetaDir"]],["!",["dir.create","outMetaDir"]]],["stop",["gettextf","\"cannot open directory '%s'\"","outMetaDir"],{"domain":"NA"}]],["<-","saveInfo",[".split_description","db"]],["saveRDS","saveInfo",["file.path","outMetaDir","\"package.rds\""]],["<-","features",["list",{"internalsID":[".Internal",["internalsID",{}]]}]],["saveRDS","features",["file.path","outMetaDir","\"features.rds\""]],["invisible",{}]]]],["<-",".split_description",["function",[{"db":"","verbose":"FALSE"}],["{",["if",["!",["is.na",["<-","Built",["[","db","\"Built\""]]]],["{",["<-","Built",["as.list",["[[",["strsplit","Built","\"; \""],"1L"]]],["if",["!=",["length","Built"],"4L"],["{",["warning",["gettextf","\"*** someone has corrupted the Built field in package '%s' ***\"",["[","db","\"Package\""]],{"domain":"NA"},{"call.":"FALSE"}],["<-","Built","NULL"]],["{",["<-",["names","Built"],["c","\"R\"","\"Platform\"","\"Date\"","\"OStype\""]],["<-",["[[","Built","\"R\""],["R_system_version",["sub","\"^R ([0-9.]+)\"","\"\\\\1\"",["[[","Built","\"R\""]]]]]]],["<-","Built","NULL"]],["<-","Depends",[".split_dependencies",["[","db",["%in%",["names","db"],"\"Depends\""]]]],["<-","ind",["match","\"base\"",["names","Depends"],"0L"]],["if","ind",["<-","Depends",["[","Depends",["-","ind"]]]],["if",["%in%","\"R\"",["names","Depends"]],["{",["<-","Rdeps2",["[","Depends",["==","\"R\"",["names","Depends"]]]],["<-",["names","Rdeps2"],"NULL"],["<-","Rdeps",["[[","Depends","\"R\"",{"exact":"TRUE"}]],["<-","Depends",["[","Depends",["!=",["names","Depends"],"\"R\""]]],["if",["&&","verbose",["==",["length","Rdeps"],"1L"]],["message","\"WARNING: omitting pointless dependence on 'R' without a version requirement\""]],["if",["<=",["length","Rdeps"],"1L"],["<-","Rdeps","NULL"]]],["<-","Rdeps2",["<-","Rdeps","NULL"]]],["<-","Rdeps",["as.vector","Rdeps"]],["<-","Suggests",[".split_dependencies",["[","db",["%in%",["names","db"],"\"Suggests\""]]]],["<-","Imports",[".split_dependencies",["[","db",["%in%",["names","db"],"\"Imports\""]]]],["<-","LinkingTo",[".split_dependencies",["[","db",["%in%",["names","db"],"\"LinkingTo\""]]]],["structure",["list",{"DESCRIPTION":"db"},{"Built":"Built"},{"Rdepends":"Rdeps"},{"Rdepends2":"Rdeps2"},{"Depends":"Depends"},{"Suggests":"Suggests"},{"Imports":"Imports"},{"LinkingTo":"LinkingTo"}],{"class":"\"packageDescription2\""}]]]],["<-",".vinstall_package_descriptions_as_RDS",["function",[{"dir":"","packages":""}],["{",["for","p",["unlist",["strsplit","packages","\"[[:space:]]+\""]],["{",["<-","meta_dir",["file.path","dir","p","\"Meta\""]],["if",["&&",["!",["dir.exists","meta_dir"]],["!",["dir.create","meta_dir"]]],["stop",["gettextf","\"cannot open directory '%s'\"","meta_dir"]]],["<-","package_info_dcf_file",["file.path","dir","p","\"DESCRIPTION\""]],["<-","package_info_rds_file",["file.path","meta_dir","\"package.rds\""]],["if",["file_test","\"-nt\"","package_info_rds_file","package_info_dcf_file"],["next"]],["saveRDS",[".split_description",[".read_description","package_info_dcf_file"]],"package_info_rds_file"]]],["invisible",{}]]]],["<-",".update_package_rds",["function",[{"lib.loc":"NULL"}],["{",["if",["is.null","lib.loc"],["<-","lib.loc",[".libPaths",{}]]],["<-","lib.loc",["[","lib.loc",["file.exists","lib.loc"]]],["for","lib","lib.loc",["{",["<-","a",["list.files","lib",{"all.files":"FALSE"},{"full.names":"TRUE"}]],["for","nam","a",["{",["<-","dfile",["file.path","nam","\"DESCRIPTION\""]],["if",["file.exists","dfile"],["{",["print","nam"],[".install_package_description","nam","nam"]]]]]]]]]],["<-",".install_package_code_files",["function",[{"dir":"","outDir":""}],["{",["if",["!",["dir.exists","dir"]],["stop",["gettextf","\"directory '%s' does not exist\"","dir"],{"domain":"NA"}]],["<-","dir",["file_path_as_absolute","dir"]],["<-","curLocale",["Sys.getlocale","\"LC_COLLATE\""]],["on.exit",["Sys.setlocale","\"LC_COLLATE\"","curLocale"],{"add":"TRUE"}],["<-","lccollate","\"C\""],["if",["!=",["Sys.setlocale","\"LC_COLLATE\"","lccollate"],"lccollate"],["{",["warning","\"cannot turn off locale-specific sorting via LC_COLLATE\""]]],["<-","db",[".read_description",["file.path","dir","\"DESCRIPTION\""]]],["<-","codeDir",["file.path","dir","\"R\""]],["if",["!",["dir.exists","codeDir"]],["return",["invisible",{}]]],["<-","codeFiles",["list_files_with_type","codeDir","\"code\"",{"full.names":"FALSE"}]],["<-","collationField",["c",["paste0","\"Collate.\"",[".OStype",{}]],"\"Collate\""]],["if",["any",["<-","i",["%in%","collationField",["names","db"]]]],["{",["<-","collationField",["[",["[","collationField","i"],"1L"]],["<-","codeFilesInCspec",[".read_collate_field",["[","db","collationField"]]],["<-","badFiles",["unique",["[","codeFilesInCspec",["duplicated","codeFilesInCspec"]]]],["if",["length","badFiles"],["{",["<-","out",["gettextf","\"\\nduplicated files in '%s' field:\"","collationField"]],["<-","out",["paste","out",["paste0","\"  \"","badFiles",{"collapse":"\"\\n\""}],{"sep":"\"\\n\""}]],["stop","out",{"domain":"NA"}]]],["<-","badFiles",["setdiff","codeFilesInCspec","codeFiles"]],["if",["length","badFiles"],["{",["<-","out",["gettextf","\"\\nfiles in '%s' field missing from '%s':\"","collationField","codeDir"]],["<-","out",["paste","out",["paste0","\"  \"","badFiles",{"collapse":"\"\\n\""}],{"sep":"\"\\n\""}]],["stop","out",{"domain":"NA"}]]],["<-","badFiles",["setdiff","codeFiles","codeFilesInCspec"]],["if",["length","badFiles"],["{",["<-","out",["gettextf","\"\\nfiles in '%s' missing from '%s' field:\"","codeDir","collationField"]],["<-","out",["paste","out",["paste0","\"  \"","badFiles",{"collapse":"\"\\n\""}],{"sep":"\"\\n\""}]],["stop","out",{"domain":"NA"}]]],["<-","codeFiles","codeFilesInCspec"]]],["<-","codeFiles",["file.path","codeDir","codeFiles"]],["if",["&&",["!",["dir.exists","outDir"]],["!",["dir.create","outDir"]]],["stop",["gettextf","\"cannot open directory '%s'\"","outDir"],{"domain":"NA"}]],["<-","outCodeDir",["file.path","outDir","\"R\""]],["if",["&&",["!",["dir.exists","outCodeDir"]],["!",["dir.create","outCodeDir"]]],["stop",["gettextf","\"cannot open directory '%s'\"","outCodeDir"],{"domain":"NA"}]],["<-","outFile",["file.path","outCodeDir",["[","db","\"Package\""]]],["if",["!",["file.create","outFile"]],["stop",["gettextf","\"unable to create '%s'\"","outFile"],{"domain":"NA"}]],["writeLines",["paste0","\".packageName <- \\\"\"",["[","db","\"Package\""],"\"\\\"\""],"outFile"],["<-","enc",["as.vector",["[","db","\"Encoding\""]]],["<-","need_enc",["!",["is.na","enc"]]],["if",["&&","need_enc",["(",["%notin%",["Sys.getlocale","\"LC_CTYPE\""],["c","\"C\"","\"POSIX\""]]]],["{",["<-","con",["file","outFile","\"a\""]],["on.exit",["close","con"]],["for","f","codeFiles",["{",["<-","lines",["readLines","f",{"warn":"FALSE"}]],["<-","tmp",["iconv","lines",{"from":"enc"},{"to":"\"\""}]],["<-","bad",["which",["is.na","tmp"]]],["if",["length","bad"],["<-","tmp",["iconv","lines",{"from":"enc"},{"to":"\"\""},{"sub":"\"byte\""}]]],["<-","comm",["grep","\"^[^#'\\\"]*#\"",["[","lines","bad"],{"invert":"TRUE"},{"useBytes":"TRUE"}]],["<-","bad2",["[","bad","comm"]],["if",["length","bad2"],["{",["warning",["sprintf",["ngettext",["length","bad2"],"\"unable to re-encode %s line %s\"","\"unable to re-encode %s lines %s\""],["sQuote",["basename","f"]],["paste","bad2",{"collapse":"\", \""}]],{"domain":"NA"},{"call.":"FALSE"}]]],["writeLines",["paste0","\"#line 1 \\\"\"","f","\"\\\"\""],"con"],["writeLines","tmp","con"]]],["close","con"],["on.exit",{}]],["{",["if",["!",["all",[".file_append_ensuring_LFs","outFile","codeFiles"]]],["stop","\"unable to write code files\""]]]],["<-","op",["options",{"showErrorCalls":"FALSE"}]],["on.exit",["options","op"]],["parse","outFile"],["invisible",{}]]]],["<-",".install_package_indices",["function",[{"dir":"","outDir":""}],["{",["options",{"warn":"1"}],["if",["!",["dir.exists","dir"]],["stop",["gettextf","\"directory '%s' does not exist\"","dir"],{"domain":"NA"}]],["if",["!",["dir.exists","outDir"]],["stop",["gettextf","\"directory '%s' does not exist\"","outDir"],{"domain":"NA"}]],["if",["file_test","\"-f\"",["file.path","dir","\"INDEX\""]],["if",["!",["file.copy",["file.path","dir","\"INDEX\""],["file.path","outDir","\"INDEX\""],{"overwrite":"TRUE"}]],["stop",["gettextf","\"unable to copy INDEX to '%s'\"",["file.path","outDir","\"INDEX\""]],{"domain":"NA"}]]],["<-","outMetaDir",["file.path","outDir","\"Meta\""]],["if",["&&",["!",["dir.exists","outMetaDir"]],["!",["dir.create","outMetaDir"]]],["stop",["gettextf","\"cannot open directory '%s'\"","outMetaDir"],{"domain":"NA"}]],[".install_package_Rd_indices","dir","outDir"],[".install_package_demo_index","dir","outDir"],["invisible",{}]]]],["<-",".install_package_Rd_indices",["function",[{"dir":"","outDir":""}],["{",["<-","dir",["file_path_as_absolute","dir"]],["<-","docsDir",["file.path","dir","\"man\""]],["<-","dataDir",["file.path","outDir","\"data\""]],["<-","outDir",["file_path_as_absolute","outDir"]],["<-","packageName",["basename","outDir"]],["<-","allRd",["if",["dir.exists","docsDir"],["list_files_with_type","docsDir","\"docs\""],["character",{}]]],["if",["length","allRd"],["{",["<-","newestRd",["max",["file.mtime","allRd"]]],["<-","indices",["c",["file.path","\"Meta\"","\"Rd.rds\""],["file.path","\"Meta\"","\"hsearch.rds\""],["file.path","\"Meta\"","\"links.rds\""],"\"INDEX\""]],["<-","upToDate",[">=",["file.mtime",["file.path","outDir","indices"]],"newestRd"]],["if",["&&",["dir.exists","dataDir"],["length",["<-","dataFiles",["list.files","dataDir"]]]],["{",["<-","newestData",["max",["file.mtime","dataFiles"]]],["<-","upToDate",["c","upToDate",[">=",["file.mtime",["file.path","outDir","\"Meta\"","\"data.rds\""]],["max","newestRd","newestData"]]]]]],["<-","RdsFile",["file.path","\"Meta\"","\"Rd.rds\""]],["if",["file.exists","RdsFile"],["{",["<-","files",["$",["readRDS","RdsFile"],"File"]],["if",["!",["identical",["basename","allRd"],"files"]],["<-","upToDate","FALSE"]]]],["if",["all",["%in%","upToDate","TRUE"]],["return",["invisible",{}]]],["<-","db",["tryCatch",["Rd_db",["basename","outDir"],{"lib.loc":["dirname","outDir"]}],{"error":["function",[{"e":""}],"NULL"]}]],["if",["is.null","db"],["<-","db",[".build_Rd_db","dir","allRd"]]],["<-","contents",["Rd_contents","db"]],[".write_Rd_contents_as_RDS","contents",["file.path","outDir","\"Meta\"","\"Rd.rds\""]],["<-","defaultEncoding",["as.vector",["[",["$",["readRDS",["file.path","outDir","\"Meta\"","\"package.rds\""]],"DESCRIPTION"],"\"Encoding\""]]],["if",["is.na","defaultEncoding"],["<-","defaultEncoding","NULL"]],["saveRDS",[".build_hsearch_index","contents","packageName","defaultEncoding"],["file.path","outDir","\"Meta\"","\"hsearch.rds\""]],["saveRDS",[".build_links_index","contents","packageName"],["file.path","outDir","\"Meta\"","\"links.rds\""]],["if",["!",["file_test","\"-f\"",["file.path","dir","\"INDEX\""]]],["writeLines",["formatDL",[".build_Rd_index","contents"]],["file.path","outDir","\"INDEX\""]]]],["{",["<-","contents","NULL"],["saveRDS",[".build_hsearch_index","contents","packageName","defaultEncoding"],["file.path","outDir","\"Meta\"","\"hsearch.rds\""]],["saveRDS",[".build_links_index","contents","packageName"],["file.path","outDir","\"Meta\"","\"links.rds\""]]]],["if",["dir.exists","dataDir"],["saveRDS",[".build_data_index","dataDir","contents"],["file.path","outDir","\"Meta\"","\"data.rds\""]]],["invisible",{}]]]],["<-",".install_package_vignettes2",["function",[{"dir":"","outDir":"","encoding":"\"\""}],["{",["<-","dir",["file_path_as_absolute","dir"]],["<-","subdirs",["c","\"vignettes\"",["file.path","\"inst\"","\"doc\""]]],["<-","ok",["dir.exists",["file.path","dir","subdirs"]]],["if",["!",["any","ok"]],["return",["invisible",{}]]],["<-","subdir",["[",["[","subdirs","ok"],"1L"]],["<-","vignetteDir",["file.path","dir","subdir"]],["<-","outDir",["file_path_as_absolute","outDir"]],["<-","packageName",["basename","outDir"]],["<-","outVignetteDir",["file.path","outDir","\"doc\""]],["if",["!",["dir.exists","outVignetteDir"]],["return",["invisible",{}]]],["<-","hasHtmlIndex",["file_test","\"-f\"",["file.path","vignetteDir","\"index.html\""]]],["<-","htmlIndex",["file.path","outDir","\"doc\"","\"index.html\""]],["<-","vigns",["pkgVignettes",{"dir":"dir"},{"subdirs":"subdir"},{"check":"TRUE"}]],["if",["==",["length",["$","vigns","docs"]],"0L"],["{",["<-","files",["list.files","vignetteDir",{"all.files":"TRUE"},{"no..":"TRUE"}]],["if",["&&",["(",[">",["length","files"],"0L"]],["!","hasHtmlIndex"]],[".writeVignetteHtmlIndex","packageName","htmlIndex"]],["return",["invisible",{}]]]],["if",["==","subdir","\"vignettes\""],["{",["file.copy",["$","vigns","docs"],"outVignetteDir"]]],["<-","vigns",["tryCatch",["{",["pkgVignettes",{"dir":"outDir"},{"subdirs":"\"doc\""},{"output":"TRUE"},{"source":"TRUE"}]],{"error":["function",[{"ex":""}],["{",["pkgVignettes",{"dir":"outDir"},{"subdirs":"\"doc\""}]]]}]],["<-","vignetteIndex",[".build_vignette_index","vigns"]],["if",[">",["NROW","vignetteIndex"],"0L"],["{",["<-","cwd",["getwd",{}]],["if",["is.null","cwd"],["stop","\"current working directory cannot be ascertained\""]],["setwd","outVignetteDir"],["loadVignetteBuilder","dir",{"mustwork":"FALSE"}],["for","i",["seq_along",["$","vigns","docs"]],["{",["<-","file",["[",["$","vigns","docs"],"i"]],["if",["&&",["!",["is.null",["$","vigns","sources"]]],["!",["is.null",["[[",["[",["$","vigns","sources"],"file"],"1"]]]],["next"]],["<-","file",["basename","file"]],["<-","enc",["[",["$","vigns","encodings"],"i"]],["cat","\"  \"",["sQuote",["basename","file"]],["if",["nzchar","enc"],["paste","\"using\"",["sQuote","enc"]]],"\"\\n\""],["<-","engine",["try",["vignetteEngine",["[",["$","vigns","engines"],"i"]],{"silent":"TRUE"}]],["if",["!",["inherits","engine","\"try-error\""]],[["$","engine","tangle"],"file",{"quiet":"TRUE"},{"encoding":"enc"}]],["setwd","outVignetteDir"]]],["setwd","cwd"],["<-","vigns",["pkgVignettes",{"dir":"outDir"},{"subdirs":"\"doc\""},{"source":"TRUE"}]],["<-","sources",["unlist",["$","vigns","sources"]]],["for","i",["seq_along","sources"],["{",["<-","file",["[","sources","i"]],["if",["!",["file_test","\"-f\"","file"]],["next"]],["<-","bfr",["readLines","file",{"warn":"FALSE"}]],["if",["all",["grepl","\"(^###|^[[:space:]]*$)\"","bfr",{"useBytes":"TRUE"}]],["unlink","file"]]]],["<-","vigns",["pkgVignettes",{"dir":"outDir"},{"subdirs":"\"doc\""},{"source":"TRUE"}]],["<-","sources",["character",["length",["$","vigns","docs"]]]],["for","i",["seq_along",["$","vigns","docs"]],["{",["<-","name",["[",["$","vigns","names"],"i"]],["<-","source",["find_vignette_product","name",{"by":"\"tangle\""},{"main":"TRUE"},{"dir":["$","vigns","dir"]},{"engine":"engine"}]],["if",[">",["length","source"],"0L"],["<-",["[","sources","i"],["basename","source"]]]]],["<-",["$","vignetteIndex","R"],"sources"]]],["if",["!","hasHtmlIndex"],[".writeVignetteHtmlIndex","packageName","htmlIndex","vignetteIndex"]],["saveRDS","vignetteIndex",{"file":["file.path","outDir","\"Meta\"","\"vignette.rds\""]}],["invisible",{}]]]],["<-",".install_package_vignettes3",["function",[{"dir":"","outDir":"","encoding":"\"\""}],["{",["<-","packageName",["basename","outDir"]],["<-","dir",["file_path_as_absolute","dir"]],["<-","indexname",["file.path","dir","\"build\"","\"vignette.rds\""]],["<-","ok",["file_test","\"-f\"","indexname"]],["if",["!","ok"],["return",["invisible",{}]]],["file.copy","indexname",["file.path","outDir","\"Meta\""]],["<-","vignetteDir",["file.path","outDir","\"doc\""]],["<-","hasHtmlIndex",["file_test","\"-f\"",["file.path","vignetteDir","\"index.html\""]]],["<-","htmlIndex",["file.path","outDir","\"doc\"","\"index.html\""]],["<-","vignetteIndex",["readRDS","indexname"]],["if",["!","hasHtmlIndex"],[".writeVignetteHtmlIndex","packageName","htmlIndex","vignetteIndex"]],["invisible",{}]]]],["<-",".install_package_demo_index",["function",[{"dir":"","outDir":""}],["{",["<-","demoDir",["file.path","dir","\"demo\""]],["if",["!",["dir.exists","demoDir"]],["return",["invisible",{}]]],["<-","demoIndex",[".build_demo_index","demoDir"]],["saveRDS","demoIndex",{"file":["file.path","outDir","\"Meta\"","\"demo.rds\""]}],["invisible",{}]]]],["<-",".vinstall_package_indices",["function",[{"src_dir":"","out_dir":"","packages":""}],["{",["for","p",["unlist",["strsplit","packages","\"[[:space:]]+\""]],[".install_package_indices",["file.path","src_dir","p"],["file.path","out_dir","p"]]],[["::","utils","make.packages.html"],".Library",{"verbose":"FALSE"}],["invisible",{}]]]],["<-",".install_package_vignettes",["function",[{"dir":"","outDir":"","keep.source":"TRUE"}],["{",["<-","dir",["file_path_as_absolute","dir"]],["<-","vigns",["pkgVignettes",{"dir":"dir"}]],["if",["||",["is.null","vigns"],["!",["length",["$","vigns","docs"]]]],["return",["invisible",{}]]],["<-","outDir",["file_path_as_absolute","outDir"]],["<-","outVignetteDir",["file.path","outDir","\"doc\""]],["if",["&&",["!",["dir.exists","outVignetteDir"]],["!",["dir.create","outVignetteDir"]]],["stop",["gettextf","\"cannot open directory '%s'\"","outVignetteDir"],{"domain":"NA"}]],["<-","vignettePDFs",["file.path","outVignetteDir",["sub","\"$\"","\".pdf\"",["basename",["file_path_sans_ext",["$","vigns","docs"]]]]]],["<-","upToDate",["file_test","\"-nt\"","vignettePDFs",["$","vigns","docs"]]],["<-","cwd",["getwd",{}]],["if",["is.null","cwd"],["stop","\"current working directory cannot be ascertained\""]],["<-","buildDir",["file.path","cwd","\".vignettes\""]],["if",["&&",["!",["dir.exists","buildDir"]],["!",["dir.create","buildDir"]]],["stop",["gettextf","\"cannot create directory '%s'\"","buildDir"],{"domain":"NA"}]],["on.exit",["setwd","cwd"]],["setwd","buildDir"],["loadVignetteBuilder",["$","vigns","pkgdir"]],["for","i",["[",["seq_along",["$","vigns","docs"]],["!","upToDate"]],["{",["<-","file",["[",["$","vigns","docs"],"i"]],["<-","name",["[",["$","vigns","names"],"i"]],["<-","engine",["vignetteEngine",["[",["$","vigns","engines"],"i"]]],["message",["gettextf","\"processing %s\"",["sQuote",["basename","file"]]],{"domain":"NA"}],["<-","output",["tryCatch",["{",[["$","engine","weave"],"file",{"pdf":"TRUE"},{"eps":"FALSE"},{"quiet":"TRUE"},{"keep.source":"keep.source"},{"stylepath":"FALSE"}],["setwd","buildDir"],["find_vignette_product","name",{"by":"\"weave\""},{"engine":"engine"}]],{"error":["function",[{"e":""}],["{",["stop",["gettextf","\"running %s on vignette '%s' failed with message:\\n%s\"",["[[","engine","\"name\""],"file",["conditionMessage","e"]],{"domain":"NA"},{"call.":"FALSE"}]]]}]],["if",["vignette_is_tex","output"],["{",["tryCatch",["{",["texi2pdf",{"file":"output"},{"quiet":"TRUE"},{"texinputs":["$","vigns","dir"]}],["<-","output",["find_vignette_product","name",{"by":"\"texi2pdf\""},{"engine":"engine"}]]],{"error":["function",[{"e":""}],["{",["stop",["gettextf","\"compiling TeX file %s failed with message:\\n%s\"",["sQuote","output"],["conditionMessage","e"]],{"domain":"NA"},{"call.":"FALSE"}]]]}]]],["if",["!",["file.copy","output","outVignetteDir",{"overwrite":"TRUE"}]],["stop",["gettextf","\"cannot copy '%s' to '%s'\"","output","outVignetteDir"],{"domain":"NA"}]]]],["setwd","cwd"],["unlink","buildDir",{"recursive":"TRUE"}],[".install_package_vignettes2","dir","outDir"],["invisible",{}]]]],["<-",".install_package_namespace_info",["function",[{"dir":"","outDir":""}],["{",["<-","dir",["file_path_as_absolute","dir"]],["<-","nsFile",["file.path","dir","\"NAMESPACE\""]],["if",["!",["file_test","\"-f\"","nsFile"]],["return",["invisible",{}]]],["<-","nsInfoFilePath",["file.path","outDir","\"Meta\"","\"nsInfo.rds\""]],["if",["file_test","\"-nt\"","nsInfoFilePath","nsFile"],["return",["invisible",{}]]],["<-","nsInfo",["parseNamespaceFile",["basename","dir"],["dirname","dir"]]],["<-","outMetaDir",["file.path","outDir","\"Meta\""]],["if",["&&",["!",["dir.exists","outMetaDir"]],["!",["dir.create","outMetaDir"]]],["stop",["gettextf","\"cannot open directory '%s'\"","outMetaDir"],{"domain":"NA"}]],["saveRDS","nsInfo","nsInfoFilePath"],["invisible",{}]]]],["<-",".vinstall_package_namespaces_as_RDS",["function",[{"dir":"","packages":""}],["{",["for","p",["unlist",["strsplit","packages","\"[[:space:]]+\""]],[".install_package_namespace_info",["file.path","dir","p"],["file.path","dir","p"]]],["invisible",{}]]]],["<-",".install_package_Rd_objects",["function",[{"dir":"","outDir":"","encoding":"\"unknown\""}],["{",["<-","dir",["file_path_as_absolute","dir"]],["<-","mandir",["file.path","dir","\"man\""]],["<-","manfiles",["if",["!",["dir.exists","mandir"]],["character",{}],["list_files_with_type","mandir","\"docs\""]]],["<-","manOutDir",["file.path","outDir","\"help\""]],["dir.create","manOutDir","FALSE"],["<-","db_file",["file.path","manOutDir",["paste0",["basename","outDir"],"\".rdx\""]]],["<-","built_file",["file.path","dir","\"build\"","\"partial.rdb\""]],["<-","macro_files",["list.files",["file.path","dir","\"man\"","\"macros\""],{"pattern":"\"\\\\.Rd$\""},{"full.names":"TRUE"}]],["if",["length","macro_files"],["{",["<-","macroDir",["file.path","manOutDir","\"macros\""]],["dir.create","macroDir","FALSE"],["file.copy","macro_files","macroDir",{"overwrite":"TRUE"}]]],["<-","pathsFile",["file.path","manOutDir","\"paths.rds\""]],["if",["||",["||",["||",["!",["file_test","\"-f\"","db_file"]],["!",["file.exists","pathsFile"]]],["!",["identical",["sort","manfiles"],["sort",["readRDS","pathsFile"]]]]],["!",["all",["file_test","\"-nt\"","db_file","manfiles"]]]],["{",["<-","db",[".build_Rd_db","dir","manfiles",{"db_file":"db_file"},{"encoding":"encoding"},{"built_file":"built_file"}]],["<-","nm",["as.character",["names","db"]]],["saveRDS",["structure","nm",{"first":["+",["nchar",["file.path","mandir"]],"2L"]}],"pathsFile"],["<-",["names","db"],["sub","\"\\\\.[Rr]d$\"","\"\"",["basename","nm"]]],["makeLazyLoadDB","db",["file.path","manOutDir",["basename","outDir"]]]]],["invisible",{}]]]],["<-",".install_package_demos",["function",[{"dir":"","outDir":""}],["{",["<-","demodir",["file.path","dir","\"demo\""]],["if",["!",["dir.exists","demodir"]],["return",{}]],["<-","demofiles",["list_files_with_type","demodir","\"demo\"",{"full.names":"FALSE"}]],["if",["!",["length","demofiles"]],["return",{}]],["<-","demoOutDir",["file.path","outDir","\"demo\""]],["if",["!",["dir.exists","demoOutDir"]],["dir.create","demoOutDir"]],["file.copy",["file.path","demodir","demofiles"],"demoOutDir",{"overwrite":"TRUE"}]]]],["<-",".find_cinclude_paths",["function",[{"pkgs":"","lib.loc":"NULL","file":"NULL"}],["{",["if",["!",["is.null","file"]],["{",["<-","tmp",["[",["read.dcf","file","\"LinkingTo\""],"1L","1L"]],["if",["is.na","tmp"],["return",["invisible",{}]]],["<-","pkgs","tmp"]]],["<-","pkgs",["[[",["strsplit",["[","pkgs","1L"],"\",[[:blank:]]*\""],"1L"]],["<-","paths",["find.package","pkgs","lib.loc",{"quiet":"TRUE"}]],["if",["length","paths"],["cat",["paste",["paste0","'-I\"'","paths","'/include\"'"],{"collapse":"\" \""}]]],["return",["invisible",{}]]]]],["<-",".Rtest_package_depends_R_version",["function",[{"dir":""}],["{",["if",["missing","dir"],["<-","dir","\".\""]],["<-","meta",[".read_description",["file.path","dir","\"DESCRIPTION\""]]],["<-","deps",["$",[".split_description","meta",{"verbose":"TRUE"}],"Rdepends2"]],["<-","status","0"],["<-","current",["getRversion",{}]],["for","depends","deps",["{",["if",[">",["length","depends"],"1L"],["{",["if",["%notin%",["$","depends","op"],["c","\"<=\"","\">=\"","\"<\"","\">\"","\"==\"","\"!=\""]],["message","\"WARNING: malformed 'Depends' field in 'DESCRIPTION'\""],["{",["<-","status",["if",["inherits",["$","depends","version"],"\"numeric_version\""],["!",["do.call",["$","depends","op"],["list","current",["$","depends","version"]]]],["{",["<-","ver","R.version"],["if",["%in%",["$","ver","status"],["c","\"\"","\"Patched\""]],"FALSE",["!",["do.call",["$","depends","op"],["list",["[[","ver","\"svn rev\""],["as.numeric",["sub","\"^r\"","\"\"",["$","depends","version"]]]]]]]]]]]],["if",["!=","status","0"],["{",["<-","package",["Sys.getenv","\"R_PACKAGE_NAME\""]],["if",["!",["nzchar","package"]],["<-","package",["[","meta","\"Package\""]]],["<-","msg",["if",["nzchar","package"],["gettextf","\"ERROR: this R is version %s, package '%s' requires R %s %s\"","current","package",["$","depends","op"],["$","depends","version"]],["gettextf","\"ERROR: this R is version %s, required is R %s %s\"","current",["$","depends","op"],["$","depends","version"]]]],["message",["strwrap","msg",{"exdent":"2L"}]],["break"]]]]]]],"status"]]],["<-",".test_package_depends_R_version",["function",[{"dir":""}],["q",{"status":[".Rtest_package_depends_R_version","dir"]}]]],["<-",".test_load_package",["function",[{"pkg_name":"","lib":""}],["{",["options",{"warn":"1"}],["<-","res",["try",["suppressPackageStartupMessages",["library","pkg_name",{"lib.loc":"lib"},{"character.only":"TRUE"},{"logical.return":"TRUE"}]]]],["if",["||",["inherits","res","\"try-error\""],["!","res"]],["stop","\"loading failed\"",{"call.":"FALSE"}]]]]],["<-","checkRdaFiles",["function",[{"paths":""}],["{",["if",["&&",["==",["length","paths"],"1L"],["dir.exists","paths"]],["{",["<-","paths",["Sys.glob",["c",["file.path","paths","\"*.rda\""],["file.path","paths","\"*.RData\""]]]],["<-","paths",["[","paths",["!",["endsWith","paths","\"/.RData\""]]]]]],["<-","res",["data.frame",{"size":"NA_real_"},{"ASCII":"NA"},{"compress":"NA_character_"},{"version":"NA_integer_"},{"stringsAsFactors":"FALSE"}]],["<-","res",["[","res",["rep_len","1L",["length","paths"]],{}]],["<-",["row.names","res"],"paths"],["<-","keep",["file.exists","paths"]],["<-",["[",["$","res","size"],"keep"],["[",["file.size","paths"],"keep"]],["for","p",["[","paths","keep"],["{",["<-","magic",["readBin","p","\"raw\"",{"n":"5"}]],["<-",["[","res","p","\"compress\""],["if",["all",["==",["[","magic",[":","1","2"]],["c","0x1f","0x8b"]]],"\"gzip\"",["if",["==",["rawToChar",["[","magic",[":","1","3"]]],"\"BZh\""],"\"bzip2\"",["if",["&&",["==",["[","magic","1L"],"0xFD"],["==",["rawToChar",["[","magic",[":","2","5"]]],"\"7zXZ\""]],"\"xz\"",["if",["grepl","\"RD[ABX][1-9]\"",["rawToChar","magic"],{"useBytes":"TRUE"}],"\"none\"","\"unknown\""]]]]],["<-","con",["gzfile","p"]],["<-","magic",["readChar","con","5L",{"useBytes":"TRUE"}]],["close","con"],["if",["grepl","\"RD[ABX][1-9]\"","magic",{"useBytes":"TRUE"}],["{",["<-",["[","res","p","\"ASCII\""],["==",["substr","magic","3","3"],"\"A\""]],["<-","ver",["sub","\"(RD[ABX])([1-9])\"","\"\\\\2\"","magic",{"useBytes":"TRUE"}]],["<-",["$","res","version"],["as.integer","ver"]]]]]],"res"]]],["<-","resaveRdaFiles",["function",[{"paths":"","compress":["c","\"auto\"","\"gzip\"","\"bzip2\"","\"xz\""],"compression_level":"","version":"NULL"}],["{",["if",["&&",["==",["length","paths"],"1L"],["dir.exists","paths"]],["<-","paths",["Sys.glob",["c",["file.path","paths","\"*.rda\""],["file.path","paths","\"*.RData\""]]]]],["<-","compress",["match.arg","compress"]],["if",["missing","compression_level"],["<-","compression_level",["switch","compress",{"\"gzip\"":"6L"},"9L"]]],["<-","getVerLoad",["function",[{"file":""}],["{",["<-","con",["gzfile","file","\"rb\""]],["on.exit",["close","con"]],["tryCatch",["$",[".Internal",["loadInfoFromConn2","con"]],"version"],{"error":["function",[{"e":""}],"1L"]}]]]],["if",["is.null","version"],["<-","version","2L"]],["for","p","paths",["{",["<-","ver",["max","version",["getVerLoad","p"]]],["<-","env",["new.env",{"hash":"TRUE"}]],["suppressPackageStartupMessages",["load","p",{"envir":"env"}]],["if",["==","compress","\"auto\""],["{",["<-","f1",["tempfile",{}]],["save",{"file":"f1"},{"list":["ls","env",{"all.names":"TRUE"}]},{"envir":"env"},{"version":"ver"}],["<-","f2",["tempfile",{}]],["save",{"file":"f2"},{"list":["ls","env",{"all.names":"TRUE"}]},{"envir":"env"},{"compress":"\"bzip2\""},{"version":"ver"}],["<-","ss",["*",["file.size",["c","f1","f2"]],["c","0.9","1.0"]]],["<-",["names","ss"],["c","f1","f2"]],["if",[">",["[","ss","1L"],"10240"],["{",["<-","f3",["tempfile",{}]],["save",{"file":"f3"},{"list":["ls","env",{"all.names":"TRUE"}]},{"envir":"env"},{"compress":"\"xz\""},{"version":"ver"}],["<-","ss",["c","ss",["file.size","f3"]]],["<-",["names","ss"],["c","f1","f2","f3"]]]],["<-","nm",["names","ss"]],["<-","ind",["which.min","ss"]],["file.copy",["[","nm","ind"],"p",{"overwrite":"TRUE"}],["unlink","nm"]],["save",{"file":"p"},{"list":["ls","env",{"all.names":"TRUE"}]},{"envir":"env"},{"compress":"compress"},{"compression_level":"compression_level"},{"version":"ver"}]]]]]]],["<-","compactPDF",["function",[{"paths":"","qpdf":["Sys.which",["Sys.getenv","\"R_QPDF\"","\"qpdf\""]],"gs_cmd":["Sys.getenv","\"R_GSCMD\"","\"\""],"gs_quality":["Sys.getenv","\"GS_QUALITY\"","\"none\""],"gs_extras":["character",{}]}],["{",["<-","use_qpdf",["nzchar","qpdf"]],["<-","qpdf_flags","\"--object-streams=generate\""],["if","use_qpdf",["{",["<-","ver",["[",["system2","qpdf","\"--version\"","TRUE"],"1L"]],["<-","ver",["as.numeric_version",["sub","\"qpdf version \"","\"\"","ver"]]],["if",["&&",["!",["is.na","ver"]],["<","ver","\"6.0.0\""]],["<-","qpdf_flags",["c","\"--stream-data=compress\"","qpdf_flags"]]]]],["<-","gs_quality",["match.arg","gs_quality",["c","\"none\"","\"printer\"","\"ebook\"","\"screen\""]]],["<-","use_gs",["if",["!=","gs_quality","\"none\""],["nzchar",["<-","gs_cmd",["find_gs_cmd","gs_cmd"]]],"FALSE"]],["if",["&&",["!","use_gs"],["!","use_qpdf"]],["return",{}]],["if",["&&",["==",["length","paths"],"1L"],["dir.exists","paths"]],["<-","paths",["Sys.glob",["file.path","paths","\"*.pdf\""]]]],["<-","dummy",["rep.int","NA_real_",["length","paths"]]],["<-","ans",["data.frame",{"old":"dummy"},{"new":"dummy"},{"row.names":"paths"}]],["<-","tf",["tempfile","\"pdf\""]],["<-","tf2",["tempfile","\"pdf\""]],["for","p","paths",["{",["<-","res","0"],["if","use_gs",["{",["<-","res",["system2","gs_cmd",["c","\"-q -dNOPAUSE -dBATCH -sDEVICE=pdfwrite\"",["sprintf","\"-dPDFSETTINGS=/%s\"","gs_quality"],"\"-dCompatibilityLevel=1.5\"","\"-dAutoRotatePages=/None\"","\"-dPrinted=false\"",["sprintf","\"-sOutputFile=%s\"","tf"],"gs_extras",["shQuote","p"]],"FALSE","FALSE"]],["if",["&&",["!","res"],"use_qpdf"],["{",["unlink","tf2"],["file.rename","tf","tf2"],["<-","res",["system2","qpdf",["c","qpdf_flags",["shQuote","tf2"],["shQuote","tf"]],"FALSE","FALSE"]],["unlink","tf2"]]]],["if","use_qpdf",["{",["<-","res",["system2","qpdf",["c","qpdf_flags",["shQuote","p"],["shQuote","tf"]],"FALSE","FALSE"]]]]],["if",["&&",["!","res"],["file.exists","tf"]],["{",["<-","old",["file.size","p"]],["<-","new",["file.size","tf"]],["if",["&&",["<",["/","new","old"],"0.9"],["<","new",["-","old","1e4"]]],["{",["file.copy","tf","p",{"overwrite":"TRUE"}],["<-",["[","ans","p",{}],["c","old","new"]]]]]],["unlink","tf"]]],["structure",[["::","stats","na.omit"],"ans"],{"class":["c","\"compactPDF\"","\"data.frame\""]}]]]],["<-","find_gs_cmd",["function",[{"gs_cmd":"\"\""}],["{",["if",["!",["nzchar","gs_cmd"]],["{",["if",["==",["$",".Platform","OS.type"],"\"windows\""],["{",["<-","gsexe",["Sys.getenv","\"R_GSCMD\""]],["if",["!",["nzchar","gsexe"]],["<-","gsexe",["Sys.getenv","\"GSC\""]]],["<-","gs_cmd",["Sys.which","gsexe"]],["if",["!",["nzchar","gs_cmd"]],["<-","gs_cmd",["Sys.which","\"gswin64c\""]]],["if",["!",["nzchar","gs_cmd"]],["<-","gs_cmd",["Sys.which","\"gswin32c\""]]],"gs_cmd"],["Sys.which",["Sys.getenv","\"R_GSCMD\"","\"gs\""]]]],["Sys.which","gs_cmd"]]]]],["<-","format.compactPDF",["function",[{"x":"","ratio":"0.9","diff":"1e4","...":""}],["{",["if",["!",["nrow","x"]],["return",["character",{}]]],["<-","z",["<-","y",["[","x",["with","x",["&",["<",["/","new","old"],"ratio"],["<","new",["-","old","diff"]]]],{}]]],["if",["!",["nrow","z"]],["return",["character",{}]]],["<-",["[","z",{}],["lapply","y",["function",[{"x":""}],["sprintf","\"%.0fKb\"",["/","x","1024"]]]]],["<-","large",[">=",["$","y","new"],["^","1024","2"]]],["<-",["[","z","large",{}],["lapply",["[","y","large",{}],["function",[{"x":""}],["sprintf","\"%.1fMb\"",["/","x",["^","1024","2"]]]]]],["paste","'  compacted'",["sQuote",["basename",["row.names","y"]]],"'from'",["[","z",{},"1L"],"'to'",["[","z",{},"2L"]]]]],["<-","add_datalist",["function",[{"pkgpath":"","force":"FALSE"}],["{",["<-","dlist",["file.path","pkgpath","\"data\"","\"datalist\""]],["if",["&&",["!","force"],["file.exists","dlist"]],["return",{}]],["<-","size",["sum",["file.size",["Sys.glob",["file.path","pkgpath","\"data\"","\"*\""]]]]],["if",["<=","size",["^","1024","2"]],["return",{}]],["<-","z",["suppressPackageStartupMessages",["list_data_in_pkg",{"dataDir":["file.path","pkgpath","\"data\""]}]]],["if",["!",["length","z"]],["return",{}]],["<-","con",["file","dlist","\"w\""]],["for","nm",["names","z"],["{",["<-","zz",["[[","z","nm"]],["if",["&&",["==",["length","zz"],"1L"],["==","zz","nm"]],["writeLines","nm","con"],["cat","nm","\": \"",["paste","zz",{"collapse":"\" \""}],"\"\\n\"",{"sep":"\"\""},{"file":"con"}]]]],["close","con"],["invisible",{}]]]]]
