[["<-",".R_LIBS",["function",[{"libp":[".libPaths",{}]}],["{",["<-","libp",["[","libp",["!",["%in%","libp",".Library"]]]],["if",["length","libp"],["paste","libp",{"collapse":["$",".Platform","path.sep"]}],"\"\""]]]],["Sys.setenv",{"R_LIBS":[".R_LIBS",{}]},{"R_BUILD_ENVIRON":"\"nothing\""},{"R_ENVIRON":"\"none\""},{"R_PROFILE":"\"none\""}],[["::","tools","assertError"],["detach","\"package:base\""]],["stopifnot",["==",["length",["installed.packages","\"mgcv\""]],"0"]],["<-","tmp",["tempfile",{}]],["writeLines",["c","'setClass(\"foo\", contains=\"numeric\")'","'setMethod(\"show\", \"foo\",'","'          function(object) cat(\"I am a \\\\\"foo\\\\\"\\\\n\"))'"],"tmp"],["if",["file.exists","\"myTst\""],["unlink","\"myTst\"",{"recursive":"TRUE"}]],["package.skeleton","\"myTst\"",{"code_files":"tmp"}],["file.copy","tmp",["(",["<-","tm2",["paste","tmp","\".R\"",{"sep":"\"\""}]]]],["unlink","\"myTst\"",{"recursive":"TRUE"}],["<-","op",["options",{"warn":"2"}]],["package.skeleton","\"myTst\"",{"code_files":"tm2"}],["options","op"],["writeLines",["c","'setClass(\"DocLink\",'","'representation(name=\"character\",'","'               desc=\"character\"))'"],"tmp"],["if",["file.exists","\"myTst2\""],["unlink","\"myTst2\"",{"recursive":"TRUE"}]],["package.skeleton","\"myTst2\"",{"code_files":"tmp"}],["stopifnot",["==","1",["grep","\"setClass\"",["readLines",["list.files","\"myTst/R\"",{"full.names":"TRUE"}]]]],["%in%",["c","\"foo-class.Rd\"","\"show-methods.Rd\""],["list.files","\"myTst/man\""]]],["<-","build.pkg",["function",[{"dir":""}],["{",["stopifnot",["dir.exists","dir"],["file.exists",["<-","DESC",["file.path","dir","\"DESCRIPTION\""]]]],["<-","pkgName",["sub","\"^[A-Za-z]+: \"","\"\"",["grep","\"^Package: \"",["readLines","DESC"],{"value":"TRUE"}]]],["<-","patt",["paste","pkgName","\".*tar\\\\.gz$\"",{"sep":"\"_\""}]],["unlink",["dir","'.'",{"pattern":"patt"}]],["<-","Rcmd",["paste",["shQuote",["file.path",["R.home","\"bin\""],"\"R\""]],"\"CMD\""]],["<-","r",["system",["paste","Rcmd","\"build --keep-empty-dirs\"",["shQuote","dir"]],{"intern":"TRUE"}]],["structure",["dir","'.'",{"pattern":"patt"}],{"log3":"r"}]]]],["build.pkg","\"myTst\""],["unlink","\"myLib\"",{"recursive":"TRUE"}],["dir.create","\"myLib\""],["install.packages","\"myTst\"",{"lib":"\"myLib\""},{"repos":"NULL"},{"type":"\"source\""}],["print",["installed.packages",{"lib.loc":"\"myLib\""},{"priority":"\"NA\""}]],["stopifnot",["require","\"myTst\"",{"lib":"\"myLib\""}]],["<-","sm",["findMethods","show",{"where":["as.environment","\"package:myTst\""]}]],["stopifnot",["==",["names",["@","sm","names"]],"\"foo\""]],["unlink","\"myTst_*\""],["require","'methods'"],["library","tools"],["<-","oo",["options",{"warn":"2"}]],["detach","\"package:tools\"",{"unload":"TRUE"}],["options","oo"],["if",["&&",["interactive",{}],["==",["Sys.getenv","\"USER\""],"\"maechler\""]],["Sys.setenv",{"SRCDIR":["normalizePath","\"~/R/D/r-devel/R/tests\""]}]],["(",["<-","pkgSrcPath",["file.path",["Sys.getenv","\"SRCDIR\""],"\"Pkgs\""]]],["if",["&&",["!",["file_test","\"-d\"","pkgSrcPath"]],["!",["interactive",{}]]],["{",["unlink","\"myTst\"",{"recursive":"TRUE"}],["print",["proc.time",{}]],["q","\"no\""]]],["<-","do.cleanup",["!",["nzchar",["Sys.getenv","\"R_TESTS_NO_CLEAN\""]]]],["<-","isWIN",["==",["$",".Platform","OS.type"],"\"windows\""]],["<-","has.symlink",["!","isWIN"]],["if",["&&",["&&",["&&",["&&","has.symlink",["!",["unlink","\"myLib_2\"",{"recursive":"TRUE"}]]],["dir.create","\"myLib_2\""]],["file.rename","\"myLib/myTst\"","\"myLib_2/myTst\""]],["file.symlink","\"../myLib_2/myTst\"","\"myLib/myTst\""]],["install.packages","\"myTst\"",{"lib":"\"myLib\""},{"repos":"NULL"},{"type":"\"source\""}]],["if","isWIN",["{",["file.copy","pkgSrcPath",["tempdir",{}],{"recursive":"TRUE"}]],["{",["system",["paste","'cp -R'",["shQuote","pkgSrcPath"],["shQuote",["tempdir",{}]]]]]],["<-","pkgPath",["file.path",["tempdir",{}],"\"Pkgs\""]],["if",["!",["dir.exists","pkgPath"]],["{",["message","\"No valid 'pkgPath' (from 'pkgSrcPath') - exit this test\""],["if",["!",["interactive",{}]],["q","\"no\""]]]],["dir.create",["file.path","pkgPath","\"pkgB\"","\"R\""],{"recursive":"TRUE"},{"showWarnings":"FALSE"}],["<-","p.lis",["c",["if",["%in%","\"Matrix\"",["row.names",["installed.packages",".Library"]]],["c","\"pkgA\"","\"pkgB\"","\"pkgC\""]],"\"exNSS4\"","\"exSexpr\""]],["<-","InstOpts",["list",{"\"exSexpr\"":"\"--html\""}]],["<-","pkgApath",["file.path","pkgPath","\"pkgA\""]],["if",["&&",["%in%","\"pkgA\"","p.lis"],["!",["dir.exists",["<-","d","pkgApath"]]]],["{",["cat","\"symlink 'pkgA' does not exist as directory \"","d","\"; copying it\\n\"",{"sep":"''"}],["file.copy",["file.path","pkgPath","\"xDir\"","\"pkg\""],{"to":"d"},{"recursive":"TRUE"}],["if",["!",["dir.exists","d"]],["<-","p.lis",["[","p.lis",["!",["(",["%in%","p.lis",["c","\"pkgA\"","\"pkgB\"","\"pkgC\""]]]]]]]]],["<-","dir2pkg",["function",[{"dir":""}],["ifelse",["==","dir","\"pkgC\""],"\"PkgC\"","dir"]]],["if",["is.na",["match","\"myLib\"",["<-",".lP",[".libPaths",{}]]]],["{",[".libPaths",["c","\"myLib\"",".lP"]],["<-",".lP",[".libPaths",{}]]]],["Sys.setenv",{"R_LIBS":[".R_LIBS",".lP"]}],["for","p","p.lis",["{",["<-","p.",["dir2pkg","p"]],["cat","\"building package\"","p.","\"...\\n\""],["<-","r",["build.pkg",["file.path","pkgPath","p"]]],["if",["!",["length","r"]],["cat",["attr","r","\"log3\""],{"sep":"\"\\n\""}]],["if",["!",["isTRUE",["file.exists","r"]]],["stop","\"R CMD build failed (no tarball) for package \"","p"]],["cat","\"installing package\"","p.","\"using built file\"","r","\"...\\n\""],["install.packages","r",{"lib":"\"myLib\""},{"repos":"NULL"},{"type":"\"source\""},{"INSTALL_opts":["[[","InstOpts","p."]}],["stopifnot",["require","p.",{"lib":"\"myLib\""},{"character.only":"TRUE"}]],["detach",{"pos":["match","p.",["sub","\"^package:\"","\"\"",["search",{}]]]}]]],["(",["<-","res",["installed.packages",{"lib.loc":"\"myLib\""},{"priority":"\"NA\""}]]],["(",["<-","p.lis",["dir2pkg","p.lis"]]],["stopifnot",{"exprs":["{",["identical",["[","res",{},"\"Package\""],["setNames",{},["sort",["c","p.lis","\"myTst\""]]]],["==",["[","res",{},"\"LibPath\""],"\"myLib\""]]}],["if",["&&",["%in%","\"pkgA\"","p.lis"],["dir.exists","pkgApath"]],["{",["cat","\"undoc(pkgA):\\n\""],["print",["<-","uA",[["::","tools","undoc"],{"dir":"pkgApath"}]]],["cat","\"codoc(pkgA):\\n\""],["print",["<-","cA",[["::","tools","codoc"],{"dir":"pkgApath"}]]],["cat","\"extends(\\\"classApp\\\"):\\n\""],["print",["<-","ext.cA",["extends","\"classApp\""]]],["stopifnot",{"exprs":["{",["identical",["$","uA","`code objects`"],["c","\"nil\"","\"search\""]],["identical",["$","uA","`data sets`"],"\"nilData\""],["%in%","\"numericA\"","ext.cA"]]}]],["message","\"'pkgA' not available\""]],["if",["dir.exists",["file.path","\"myLib\"","\"pkgA\""]],["{",["<-","msgs",["capture.output",["require","pkgA",{"lib":"\"myLib\""}],{"type":"\"message\""}]],["writeLines","msgs"],["stopifnot",[">",["length","msgs"],"2"],[">",["length",["grep","\"The following object is masked.*package:base\"","msgs"]],"0"],[">",["length",["grep","\"\\\\bsearch\\\\b\"","msgs"]],"0"]],["data",{"package":"\"pkgA\""}],["stopifnot",["is.null",["::","pkgA","nil"]],["is.null",[":::","pkgA","nil"]],["is.null",["::","pkgA","nilData"]]],[["::","tools","assertError"],["is.null",[":::","pkgA","nilData"]]]],["message","\"'pkgA' not in 'myLib'\""]],["(",["<-","okA",["&&",["dir.exists","pkgApath"],["file.exists",["<-","DN",["file.path","pkgApath","\"DESCRIPTION\""]]]]]],["if","okA",["{",["<-","Dlns",["readLines","DN"]],["<-","i",["grep","\"^LazyData:\"","Dlns"]],["<-",["[","Dlns","i"],["paste0",["[","Dlns","i"],"\",\""]],["writeLines","Dlns",{"con":"DN"}],["<-","instEXPR",["quote",[[":::","tools",".install_packages"],["c","\"--clean\"","\"--library=myLib\"","pkgApath"],{"no.q":"TRUE"}]]],["if",["interactive",{}],["{",["<-","ftf",["file",["<-","tf",["tempfile","\"inst_pkg\""]],{"open":"\"wt\""}]],["sink","ftf"],["sink","ftf",{"type":"\"message\""}],["eval","instEXPR"],["sink",{"type":"\"message\""}],["sink",{}],["writeLines",["paste","\" \"",["<-","msgs",["readLines","tf"]]]],["message",["<-","err",["grep","\"^ERROR:\"","msgs",{"value":"TRUE"}]]],["stopifnot",{"exprs":["{",[">",["length","err"],"0"],["grepl","\"invalid .*LazyData .*DESCRIPTION\"","err"]]}]],["{",["message","\"non-interactive -- tools:::.install_packages(..) : \""],["try",["eval","instEXPR"]]]]],["message","\"pkgA/DESCRIPTION  not available\""]],["<-","msg",["capture.output",[[":::","tools",".check_package_parseRd"],{"dir":["file.path","pkgPath","\"exSexpr\""]}]]],["if",["length","msg"],["stop","\".check_package_parseRd() gave message\\n\"","msg"]],["if",["dir.exists",["file.path","\"myLib\"","\"exNSS4\""]],["{",["require","\"exNSS4\"",{"lib":"\"myLib\""}],["validObject",["<-","dd",["new","\"ddiM\""]]],["print",["is","dd"]],["stopifnot",{"exprs":["{",["is","dd","\"mM\""],["inherits","dd","\"mM\""]]}],["if",["dir.exists",["file.path",".Library","\"Matrix\""]],["{",["for","ns",["c",["rev","p.lis"],"\"Matrix\""],["unloadNamespace","ns"]],["requireNamespace","\"exNSS4\"",{"lib":"\"myLib\""}],["stopifnot",["isVirtualClass",["getClass","\"atomicVector\""]]],["requireNamespace","\"Matrix\"",{"lib":".Library"}],[["::","tools","assertCondition"],["<-","acl",["getClass","\"atomicVector\""]]],["library","Matrix"],["stopifnot",["isVirtualClass",["getClass","\"atomicVector\""]]]]]]],["<-","rmL",["c","\"myLib\"",["if","has.symlink","\"myLib_2\""],"\"myTst\"",["file.path","pkgPath"]]],["if","do.cleanup",["{",["for","nm","rmL",["unlink","nm",{"recursive":"TRUE"}]]],["{",["cat","\"Not cleaning, i.e., keeping \"",["paste","rmL",{"collapse":"\", \""}],"\"\\n\""]]],["proc.time",{}]]
